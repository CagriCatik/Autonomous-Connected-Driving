<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-task/sensor_data_processing/Semantic-Point-Cloud-Segmentation" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Perform Deep Learning based Semantic Point Cloud Segmentation | Automated and Connected Driving</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://cagricatik.github.io/Autonomous-Connected-Driving/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://cagricatik.github.io/Autonomous-Connected-Driving/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://cagricatik.github.io/Autonomous-Connected-Driving/docs/task/sensor_data_processing/Semantic-Point-Cloud-Segmentation"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Perform Deep Learning based Semantic Point Cloud Segmentation | Automated and Connected Driving"><meta data-rh="true" name="description" content="ROS2"><meta data-rh="true" property="og:description" content="ROS2"><link data-rh="true" rel="icon" href="/Autonomous-Connected-Driving/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://cagricatik.github.io/Autonomous-Connected-Driving/docs/task/sensor_data_processing/Semantic-Point-Cloud-Segmentation"><link data-rh="true" rel="alternate" href="https://cagricatik.github.io/Autonomous-Connected-Driving/docs/task/sensor_data_processing/Semantic-Point-Cloud-Segmentation" hreflang="en"><link data-rh="true" rel="alternate" href="https://cagricatik.github.io/Autonomous-Connected-Driving/docs/task/sensor_data_processing/Semantic-Point-Cloud-Segmentation" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/Autonomous-Connected-Driving/blog/rss.xml" title="Automated and Connected Driving RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/Autonomous-Connected-Driving/blog/atom.xml" title="Automated and Connected Driving Atom Feed"><link rel="stylesheet" href="/Autonomous-Connected-Driving/assets/css/styles.ce2d5abf.css">
<script src="/Autonomous-Connected-Driving/assets/js/runtime~main.6387bea5.js" defer="defer"></script>
<script src="/Autonomous-Connected-Driving/assets/js/main.b69c5ba1.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Autonomous-Connected-Driving/"><div class="navbar__logo"><img src="/Autonomous-Connected-Driving/img/logo.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/Autonomous-Connected-Driving/img/logo.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/Autonomous-Connected-Driving/docs/theory/introduction-tools/getting_started">Introduction &amp; Tools</a><a class="navbar__item navbar__link" href="/Autonomous-Connected-Driving/docs/theory/sensor-data-processing/getting_started">Sensor Data Processing</a><a class="navbar__item navbar__link" href="/Autonomous-Connected-Driving/docs/theory/object-fusion-tracking/getting_started">Object Fusion and Tracking</a><a class="navbar__item navbar__link" href="/Autonomous-Connected-Driving/docs/theory/vehicle-guidance/getting_started">Vehicle Guidance</a><a class="navbar__item navbar__link" href="/Autonomous-Connected-Driving/docs/theory/connected-driving/getting_started">Connected Driving</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/Autonomous-Connected-Driving/docs/task/getting_started">Tasks</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/Autonomous-Connected-Driving/docs/cpp/getting_started">C++</a><a class="navbar__item navbar__link" href="/Autonomous-Connected-Driving/docs/python/getting_started">Python</a><a class="navbar__item navbar__link" href="/Autonomous-Connected-Driving/docs/ros/getting_started">ROS</a><a class="navbar__item navbar__link" href="/Autonomous-Connected-Driving/docs/ros2/getting_started">ROS2</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Autonomous-Connected-Driving/docs/task/getting_started">Getting Started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/Autonomous-Connected-Driving/docs/category/introduction--tools">Introduction &amp; Tools</a><button aria-label="Expand sidebar category &#x27;Introduction &amp; Tools&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/Autonomous-Connected-Driving/docs/category/sensor-data-processing">Sensor Data Processing</a><button aria-label="Collapse sidebar category &#x27;Sensor Data Processing&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Autonomous-Connected-Driving/docs/task/sensor_data_processing/Camera-based-Semantic-Grid-Mapping">Camera-based Semantic Grid Mapping</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Autonomous-Connected-Driving/docs/task/sensor_data_processing/Deep-OGM">Deep Learning-based Point Cloud Occupancy Grid Mapping</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Autonomous-Connected-Driving/docs/task/sensor_data_processing/Geometric-OGM">Geometric Point Cloud Occupancy Grid Mapping</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Autonomous-Connected-Driving/docs/task/sensor_data_processing/Localization">Localization</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Autonomous-Connected-Driving/docs/task/sensor_data_processing/Object-Detection">Object Detection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Autonomous-Connected-Driving/docs/task/sensor_data_processing/Semantic-Image-Segmentation">Perform Deep Learning based semantic image segmentation applied on camera images</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Autonomous-Connected-Driving/docs/task/sensor_data_processing/Semantic-Point-Cloud-Segmentation">Perform Deep Learning based Semantic Point Cloud Segmentation</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/Autonomous-Connected-Driving/docs/category/object-fusion-tracking">Object Fusion Tracking</a><button aria-label="Expand sidebar category &#x27;Object Fusion Tracking&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/Autonomous-Connected-Driving/docs/category/vehicle-guidance">Vehicle Guidance</a><button aria-label="Expand sidebar category &#x27;Vehicle Guidance&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/Autonomous-Connected-Driving/docs/category/connected-driving">Connected Driving</a><button aria-label="Expand sidebar category &#x27;Connected Driving&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/Autonomous-Connected-Driving/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/Autonomous-Connected-Driving/docs/category/sensor-data-processing"><span itemprop="name">Sensor Data Processing</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Perform Deep Learning based Semantic Point Cloud Segmentation</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Perform Deep Learning based Semantic Point Cloud Segmentation</h1></header>
<p><img decoding="async" loading="lazy" src="https://img.shields.io/badge/ROS2-red" alt="ROS2" class="img_ev3q"></p>
<img src="../images/video2.gif" alt="Description of image">
<p>In this workshop, we will perform <strong>semantic point cloud segmentation</strong> on raw LiDAR data using the deep learning model from the notebooks. In particular, we will take a recording from our test vehicle which is equipped with a Velodyne VLP-32C and we will apply our detection model on the raw sensor data.</p>
<p>The  learning goals of this workshop are</p>
<ul>
<li>Inspect a rosbag which contains point cloud data</li>
<li>Learn about ROS2&#x27; standard point cloud message definition <code>points2</code></li>
<li>Learn about a simple Python inference node for semantic point cloud segmentation</li>
<li>Implement a ROS2 publisher which publishes the segmented point cloud</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="start-the-docker-environment">Start the Docker Environment<a href="#start-the-docker-environment" class="hash-link" aria-label="Direct link to Start the Docker Environment" title="Direct link to Start the Docker Environment">​</a></h2>
<p>Navigate to the local directory <code>${REPOSITORY}/docker</code> and execute <code>./ros2_run.sh</code>. This will start the Docker container, in which ROS and all required libraries are preinstalled. You can stop the container by pressing <kbd>Ctrl</kbd>+<kbd>C</kbd> in the terminal. If everything is setup correctly you will see the following:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Starting new container...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">================================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=== CONTAINER INFORMATION ======================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Architecture: x86_64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ubuntu: 22.04.2 LTS (Jammy Jellyfish)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Python: 3.10.6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ROS: humble</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CMake: 3.22.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CUDA: 12.1.105</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cuDNN: 8.9.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TensorRT: 8.6.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TensorFlow Python: 2.13.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TensorFlow C/C++: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PyTorch Python: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PyTorch C/C++: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Available GPUs: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name               driver_version   utilization.gpu [%]   utilization.memory [%]   memory.used [MiB]   memory.total [MiB]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  NVIDIA TITAN RTX   470.182.03       0 %                   2 %                      552 MiB             24217 MiB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">===============================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@******:/home/rosuser/ws/colcon_workspace# </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <code>acdc</code> folder is mounted from your host into the container. Note that your current working directory inside the container is <code>/home/rosuser/ws/colcon_workspace</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="download-and-inspect-bag-file">Download and inspect bag file<a href="#download-and-inspect-bag-file" class="hash-link" aria-label="Direct link to Download and inspect bag file" title="Direct link to Download and inspect bag file">​</a></h2>
<p>Download the file <code>lidar_campus_melaten.db3</code> from <a href="https://rwth-aachen.sciebo.de/s/YALin3OaIdRjmhQ" target="_blank" rel="noopener noreferrer">here (1.5 GB)</a>.</p>
<p>Save this file to your local directory <code>${REPOSITORY}/bag</code>. This directory will be mounted into the docker container to the path <code>/home/rosuser/ws/bag</code>.</p>
<p>You can start the docker container now with <code>./ros2_run.sh</code> (if you haven&#x27;t already).</p>
<p>Inside the container, you can navigate to <code>/home/rosuser/ws/bag</code> and execute <code>ros2 bag info lidar_campus_melaten.db3</code> to inspect the rosbag:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">~/bag$ ros2 bag info lidar_campus_melaten.db3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Files:             lidar_campus_melaten.db3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Bag size:          1.5 GiB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Storage id:        sqlite3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Duration:          119.955s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Start:             Feb  5 2020 16:25:31.409 (1580916331.409)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End:               Feb  5 2020 16:27:31.365 (1580916451.365)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Messages:          1200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Topic information: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Topic: /points2 | Type: sensor_msgs/msg/PointCloud2 | Count: 1199 | </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Serialization Format: cdr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Topic: /tf_static | Type: tf2_msgs/msg/TFMessage | Count: 1 | </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Serialization Format: cdr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can see that the rosbag has a duration of 1 minute and 59 seconds and contains 1199 frames of type <code>sensor_msgs/PointCloud2</code>. We will use these point cloud data in this assignment in order to apply semantic point cloud segmentation.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ros2s-sensor_msgsmsgpointcloud2-message">ROS2&#x27;s <code>sensor_msgs/msg/PointCloud2</code> Message<a href="#ros2s-sensor_msgsmsgpointcloud2-message" class="hash-link" aria-label="Direct link to ros2s-sensor_msgsmsgpointcloud2-message" title="Direct link to ros2s-sensor_msgsmsgpointcloud2-message">​</a></h2>
<p>The message definition <a href="https://docs.ros2.org/foxy/api/sensor_msgs/msg/PointCloud2.html" target="_blank" rel="noopener noreferrer">sensor_msgs/PointCloud2</a> is ROS&#x27; standard point cloud message format.
Each message contains a collection of XYZ points, which may also contain additional information such as timestamp, intensity or ring number. Feel free to read the documentation of <a href="https://docs.ros2.org/foxy/api/sensor_msgs/msg/PointCloud2.html" target="_blank" rel="noopener noreferrer">sensor_msgs/msg/PointCloud2</a> to learn more details about it.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="build-and-source-the-package">Build and source the package<a href="#build-and-source-the-package" class="hash-link" aria-label="Direct link to Build and source the package" title="Direct link to Build and source the package">​</a></h2>
<p>The code for the image segmentation inference node can be found in the directory <code>src/section_2/pointcloud_segmentation_r2</code>. The structure of this <strong>Python package</strong> is illustrated in the following:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pointcloud_segmentation_r2/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── package.xml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── setup.cfg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── setup.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── params.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── assets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── image1.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── image2.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── video1.gif</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── video2.gif</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── launch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── start_all.launch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── models</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── class_id_to_rgb.xml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── miou62_squeezeseg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       ├── saved_model.pb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── keras_metadata.pb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       └── variables</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│           ├── variables.data-00000-of-00001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│           └── variables.index</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── pointcloud_segmentation_r2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   |── pointcloud_segmentation.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   └── __init__.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── resource</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── test    </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The inference node source code is located in <code>pointcloud_segmentation_r2/pointcloud_segmentation.py</code>. The pretrained model is located in the directory <code>models</code>. The launch file and parameters are located in directory <code>launch</code>. The conversion between RGB encoding and class IDs are defined in <code>class_id_to_rgb.xml</code>. Feel free to read all the code, parameters and launch files to get a in-depth understanding how this inference node is working.</p>
<p>Note that the provided point cloud segmentation model is quite similar to the one you have trained in the assignment, but it was trained on a much larger dataset consisting of 40000 training samples.</p>
<p>Now, let&#x27;s build the package with with <code>colcon build</code></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">colcon build --packages-select pointcloud_segmentation_r2 --symlink-install</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>and source the workspace</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">source install/setup.bash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Perfect! Now you will be able to perform inference on point cloud data with this package. Let&#x27;s go to the next section.</p>
<h1>Replay rosbag and run pointcloud segmentation</h1>
<p>We have already prepared a launch file for you to execute the image segmentation. Please read carefully through the following lines of code.</p>
<p>Contents of the file <code>image_segmentation_r2.launch.py</code>:</p>
<div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> ament_index_python</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">packages </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> get_package_share_directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> launch </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> LaunchDescription</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> launch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">actions </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> DeclareLaunchArgument</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> launch_ros</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">actions </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> launch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">actions </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> ExecuteProcess</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">generate_launch_description</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Get the package and params directory</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    image_segmentation_dir </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> get_package_share_directory</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;pointcloud_segmentation_r2&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image_segmentation_dir</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;config&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&quot;params.yaml&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Declare launch arguments</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use_sim_time </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> DeclareLaunchArgument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;use_sim_time&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        default_value</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;true&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        description</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;Use simulation clock time&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># ROSBAG PLAY node</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rosbag_play_node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ExecuteProcess</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cmd</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;ros2&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;bag&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;play&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;--rate&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;0.75&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;-l&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token string" style="color:#e3116c">&#x27;/home/rosuser/bag/lidar_campus_melaten&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        output</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;screen&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># CAMERA SEGMENTATION NODE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pointcloud_segmentation_node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Node</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        package</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;pointcloud_segmentation_r2&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;pointcloud_segmentation&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        executable</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;pointcloud_segmentation&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        output</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;screen&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        parameters</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Create the launch description and populate</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ld </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> LaunchDescription</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Add the actions to the launch description</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ld</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add_action</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">use_sim_time</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ld</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add_action</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rosbag_play_node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ld</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add_action</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pointcloud_segmentation_node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> ld</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This launch file will start the following tasks:</p>
<ul>
<li><strong>Replay the rosbag</strong> with a speed of 0.75. Feel free to adjust this replay speed depending on the performance of your hardware.</li>
<li><strong>Start the <code>pointcloud_segmentation_py</code></strong> node with the parameters__ that are necessary for the <code>pointcloud_segmentation_py</code> node.
Note, that <code>params.yaml</code> contains the parameter</li>
</ul>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">do_visualizations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">True</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>which will enable an internal visualization of the segmented point cloud. You can also set this value to <code>False</code> and visualize the point cloud with RVIZ.</p>
<p>We can now start the launch file with:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ros2 launch pointcloud_segmentation_r2 pointcloud_segmentation_r2.launch.py </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You should see now the model&#x27;s prediction as shown in the image below.</p>
<img src="../images/uploads/4a7ce26ec2d312a8a6396adaab190936/image.png" alt="Description of image">
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="review-of-file-pointcloud_segmentationpy">Review of file pointcloud_segmentation.py<a href="#review-of-file-pointcloud_segmentationpy" class="hash-link" aria-label="Direct link to Review of file pointcloud_segmentation.py" title="Direct link to Review of file pointcloud_segmentation.py">​</a></h2>
<p>Before we start with the programming exercise, lets get an overview about the point cloud segmentation node <a href="https://github.com/ika-rwth-aachen/acdc/blob/main/colcon_workspace/src/section_2/pointcloud_segmentation_r2/image_segmentation_r2/image_segmentation.py" target="_blank" rel="noopener noreferrer"><code>pointcloud_segmentation.py</code></a>.Note, the segmentation node is quite complex and we do not require you to implement any in-depth function. We would like to encourage you to read the code and try to understand what each function is doing. To help you we have generated a little summary about the structure of the inference node.</p>
<p>The inference node is implemented as a Python class called <code>PCLSegmentation</code>. The class has the following member functions. We will give here a short description of each class so you can understand what each class is doing.</p>
<ul>
<li>
<p><strong>class PCLSegmentation</strong></p>
<p><em>Class which implements the point cloud segmentation task. Listens on a topic of type <code>PointCloud2</code> converts the point cloud to a 2D representation, applies point cloud segmentation and publishes the segmented point cloud on a <code>PointCloud2</code> topic.</em></p>
<ul>
<li><strong><code>__init__(self)</code></strong></li>
</ul>
<p><em>Calls all necessary functions for the initialization of the node</em></p>
<ul>
<li><strong><code>def setup(self)</code></strong></li>
</ul>
<p><em>Loads and initializes the segmentation model from a file. Creates subscriber <code>self.sub_pcl</code> and publisher <code>self.pub_seg</code> which listen and send <code>PointCloud2</code></em></p>
<ul>
<li><strong><code>load_parameters(self)</code></strong></li>
</ul>
<p><em>Loads all ROS params and stores them as class members attributes,</em></p>
<ul>
<li><strong><code>parse_convert_xml(self, conversion_file_path)</code></strong></li>
</ul>
<p><em>Reads the xml file from directory <code>convert_xml</code> and constructs all necessary variables for the class ID to color association.</em></p>
<ul>
<li><strong><code>def predict(self, pcl_msg)</code></strong></li>
</ul>
<p><em>Callback function which is triggered when a new message of type <code>PointCloud2</code> arrives at the subscriber <code>self.sub_pcl</code></em></p>
<ul>
<li><strong><code>make_point_field(self)</code></strong></li>
</ul>
<p><em>Helper function to create a <code>PointCloud2</code> with several fields.</em></p>
<ul>
<li><strong><code>rgb_to_float(self, color)</code></strong></li>
</ul>
<p><em>Helper function which can convert a RGB value to a packed float value</em></p>
<ul>
<li><strong><code>hv_in_range(self, x, y, z, fov, fov_type=&#x27;h&#x27;)</code></strong></li>
</ul>
<p><em>Function which can apply a field of view (FOV) to points with X, Y, Z values.</em></p>
<ul>
<li><strong><code>pcl_spherical_projection(self, pcl, height, width, num_channels, leftPhi, rightPhi)</code></strong></li>
</ul>
<p><em>Function which does a spherical projection of a 3D point cloud to a 2D representation</em></p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="task-1-instantiate-pointcloud2-publisher-for-the-segmented-point-cloud">Task 1: Instantiate <code>PointCloud2</code> publisher for the segmented point cloud<a href="#task-1-instantiate-pointcloud2-publisher-for-the-segmented-point-cloud" class="hash-link" aria-label="Direct link to task-1-instantiate-pointcloud2-publisher-for-the-segmented-point-cloud" title="Direct link to task-1-instantiate-pointcloud2-publisher-for-the-segmented-point-cloud">​</a></h2>
<p>In this task, you will have the easy task to implement a publisher for the segmented point cloud. As you may know, the publisher takes specific messages and sends them via the ROS Framework to other processing or visualization nodes.</p>
<p>Read the function <code>setup()</code> in the file <code>pointcloud_segmentation.py</code>. Here all important class members are created that will be called in later during the inference. You can see that we instantiate the segmentation model as <code>self.model</code>.</p>
<p>We also instantiate the subscriber for the <code>/points2</code> topic as <code>self.sub_pcl</code>. The subscriber is connected with the function <code>self.predict</code>. Whenever a new message of type <code>PointCloud2</code> arrives on <code>/point2</code>, then the callback <code>self.predict</code> is called.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">setup</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># load inference model</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">model </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">keras</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">models</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">load_model</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">model_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># create point field for cloud_creator</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">point_field </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">make_point_field</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">### START TASK 1 CODE HERE ###</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># create publisher for the segmented point cloud, publish on topic &quot;points2_segmented&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Publish type PointCloud2 data format</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">### END TASK 1 CODE HERE ###</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># create points2 subcriber and listen to topic /points2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sub_pcl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">create_subscription</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">PointCloud2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/points2&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">predict</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Your task is now to implement a <code>PointCloud2</code> publisher.</p>
<p><em>Hints:</em></p>
<ul>
<li>Have a look how a <a href="https://docs.ros.org/en/humble/Tutorials/Beginner-Client-Libraries/Writing-A-Simple-Py-Publisher-And-Subscriber.html" target="_blank" rel="noopener noreferrer">self.create_publisher()</a> works</li>
<li>We want to send messages on topic <code>/points2_segmented</code></li>
<li>We want to send messages of type <code>PointCloud2</code> which are already imported by <code>from sensor_msgs.msg import PointCloud2</code></li>
<li>Use a <code>queue_size</code> of 1</li>
<li>Save the publisher as a class member attribute</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="task-2-publish-a-pointcloud2-message-containing-the-segmented-point-cloud-with-the-publisher">Task 2: Publish a <code>PointCloud2</code> message containing the segmented point cloud with the publisher<a href="#task-2-publish-a-pointcloud2-message-containing-the-segmented-point-cloud-with-the-publisher" class="hash-link" aria-label="Direct link to task-2-publish-a-pointcloud2-message-containing-the-segmented-point-cloud-with-the-publisher" title="Direct link to task-2-publish-a-pointcloud2-message-containing-the-segmented-point-cloud-with-the-publisher">​</a></h2>
<p>Ok, now you should have setup the publisher. Now, we need to call the publisher after we perform inference in order to publish the segmented point cloud on topic <code>/points2_segmented</code>. The following code block is a snippet from function <code>def predict(self, pcl_msg)</code> in the file <code>pointcloud_segmentation.py</code>.</p>
<p>You will now have to call the publisher here</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># create list of points</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">points </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">list</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">zip</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> z</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> l</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> rgb_float</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">segmented_pcl_msg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pc2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">create_cloud</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">header</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pcl_msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">header</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                     fields</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">point_field</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                     points</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">points</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">### START TASK 2 CODE HERE ###</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># call publisher to publish &quot;segmented_pcl_msg&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">### END TASK 2 CODE HERE###</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><em>Hints:</em></p>
<ul>
<li>Use <code>.publish()</code></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="run-node-and-use-rviz-for-visualization">Run Node and use RVIZ for visualization<a href="#run-node-and-use-rviz-for-visualization" class="hash-link" aria-label="Direct link to Run Node and use RVIZ for visualization" title="Direct link to Run Node and use RVIZ for visualization">​</a></h2>
<p>Great, so now our inference node also publishes the segmented point cloud and we can now use RVIZ to visualize the segmented point cloud. You can open another terminal and start RVIZ:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ros2 run rviz2 rviz2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In RVIZ you could try to visualize the segmented point cloud to obtain an image as shown below.</p>
<p><em>Hints:</em></p>
<ul>
<li>Add -&gt; By Topic -&gt; <code>/points2_segmented</code> - <code>PointCloud2</code> -&gt; OK</li>
<li>Set the parameter <code>Global Options / Fixed Frame</code> to <code>vlp16_link</code></li>
<li>Increase the <code>Size</code> of the points</li>
</ul>
<img src="../images/uploads/cb4ded5b551f6fe13d9efeeac8180b86/image1.png" alt="Description of image">
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="wrap-up">Wrap-up<a href="#wrap-up" class="hash-link" aria-label="Direct link to Wrap-up" title="Direct link to Wrap-up">​</a></h2>
<ul>
<li>You learned about the ROS2 standard definition for point cloud data which is called <code>sensor_msgs/PointCloud2</code></li>
<li>You learned about a simple ROS2 package for semantic point cloud segmentation</li>
<li>You learned how to write a ROS2 publisher which publishes point cloud data</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ros1-instructions">ROS1 Instructions<a href="#ros1-instructions" class="hash-link" aria-label="Direct link to ROS1 Instructions" title="Direct link to ROS1 Instructions">​</a></h2>
<p><img decoding="async" loading="lazy" src="https://img.shields.io/badge/ROS1-blue" alt="ROS1" class="img_ev3q"></p>
<img src="../images/video2.gif" alt="Description of image">
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="perform-deep-learning-based-semantic-point-cloud-segmentation-1">Perform Deep Learning based Semantic Point Cloud Segmentation<a href="#perform-deep-learning-based-semantic-point-cloud-segmentation-1" class="hash-link" aria-label="Direct link to Perform Deep Learning based Semantic Point Cloud Segmentation" title="Direct link to Perform Deep Learning based Semantic Point Cloud Segmentation">​</a></h4>
<p>In this workshop, we will perform <strong>semantic point cloud segmentation</strong> on raw LiDAR data using the deep learning model from the notebooks. In particular, we will take a recording from our test vehicle which is equipped with a Velodyne VLP-32C and we will apply our detection model on the raw sensor data.</p>
<p>The  learning goals of this workshop are</p>
<ul>
<li>Inspect a rosbag which contains point cloud data</li>
<li>Learn about ROS&#x27; standard point cloud message definition <code>points2</code></li>
<li>Learn about a simple Python inference node for semantic point cloud segmentation</li>
<li>Implement a ROS publisher which publishes the segmented point cloud</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="use-the-docker-environment">Use the Docker Environment<a href="#use-the-docker-environment" class="hash-link" aria-label="Direct link to Use the Docker Environment" title="Direct link to Use the Docker Environment">​</a></h2>
<p>Navigate to the local directory <code>acdc/docker</code> and execute <code>./ros1_run.sh</code>. This will start the Docker container, in which ROS and all required libraries are preinstalled. You can stop the container by pressing <kbd>Ctrl</kbd>+<kbd>C</kbd> in the terminal. If everything is setup correctly you will see the following:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Starting container ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting container in mode: gpu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">non-network local connections being added to access control list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Container setup:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Ubuntu: 20.04.2 LTS (Focal Fossa) (user: rosuser, password: rosuser)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- CUDA: Cuda compilation tools, release 11.2, V11.2.152</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- cuDNN: 8.1.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- TensorRT: 8.0.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- TensorFlow Python3: 2.6.0 (GPUs available: 1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- TensorFlow C/C++: 2.6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- ROS: noetic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- CMake: cmake version 3.12.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Template Commands:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Create new ROS package:            ros-add-package</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Add node to package:               ros-add-node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Add nodelet to package:            ros-add-nodelet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Initialize ROS GitLab repository:  ros-init-repo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">https://gitlab.ika.rwth-aachen.de/automated-driving/docker#templates</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The container is running. Execute the run script again from another terminal to open a shell in the container or press `CTRL-C` to stop the container.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>From another terminal, execute <code>./ros1_run.sh</code> again to open a shell in the running container. You should see this:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Attaching to running container ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">===================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">= ROS Docker Container                                            =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">===================================================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">This is the image.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rosuser@******:~/ws/catkin_workspace$</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <code>acdc</code> folder is mounted from your host into the container. Note that your current working directory in the container is <code>/home/rosuser/ws/catkin_workspace</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="download-and-inspect-bag-file-1">Download and inspect bag file<a href="#download-and-inspect-bag-file-1" class="hash-link" aria-label="Direct link to Download and inspect bag file" title="Direct link to Download and inspect bag file">​</a></h2>
<p>Download the file <code>lidar_campus_melaten.bag</code> from <a href="https://rwth-aachen.sciebo.de/s/udlMYloXpCdVtyp" target="_blank" rel="noopener noreferrer">here (1.7 GB)</a>.</p>
<p>Save this file to your local directory <code>${REPOSITORY}/bag</code>. This directory will be mounted into the docker container to the path <code>/home/rosuser/bag</code>.</p>
<p>You can start the docker container now with <code>./ros1_run.sh</code> (if you haven&#x27;t already).</p>
<p>Inside the container, you can navigate to <code>/home/rosuser/bag</code> and execute <code>rosbag info lidar_campus_melaten.bag</code> to inspect the rosbag:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">~/bag$ rosbag info lidar_campus_melaten.bag </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">path:        lidar_campus_melaten.bag</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">version:     2.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">duration:    1:59s (119s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">start:       Feb 05 2020 16:25:31.41 (1580916331.41)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end:         Feb 05 2020 16:27:31.37 (1580916451.37)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">size:        1.5 GB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">messages:    1200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">compression: none [1199/1199 chunks]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">types:       sensor_msgs/PointCloud2 [1158d486dd51d683ce2f1be655c3c181]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             tf2_msgs/TFMessage      [94810edda583a504dfda3829e70d7eec]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">topics:      /points2     1199 msgs    : sensor_msgs/PointCloud2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             /tf_static      1 msg     : tf2_msgs/TFMessage</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can see that the rosbag has a duration of 1 minute and 59 seconds and contains 1199 frames of type <code>sensor_msgs/PointCloud2</code>. We will use these point cloud data in this assignment in order to apply semantic point cloud segmentation.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ross-sensor_msgspointcloud2-message">ROS&#x27;s <code>sensor_msgs/PointCloud2</code> Message<a href="#ross-sensor_msgspointcloud2-message" class="hash-link" aria-label="Direct link to ross-sensor_msgspointcloud2-message" title="Direct link to ross-sensor_msgspointcloud2-message">​</a></h2>
<p>The message definition <a href="http://docs.ros.org/en/melodic/api/sensor_msgs/html/msg/PointCloud2.html" target="_blank" rel="noopener noreferrer">sensor_msgs/PointCloud2</a> is ROS&#x27; standard point cloud message format.
Each message contains a collection of XYZ points, which may also contain additional information such as timestamp, intensity or ring number. Feel free to read the documentation of <a href="http://docs.ros.org/en/melodic/api/sensor_msgs/html/msg/PointCloud2.html" target="_blank" rel="noopener noreferrer">sensor_msgs/PointCloud2</a> to learn more details about it.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="build-and-source-the-package-1">Build and source the package<a href="#build-and-source-the-package-1" class="hash-link" aria-label="Direct link to Build and source the package" title="Direct link to Build and source the package">​</a></h2>
<p>The code for the point cloud segmentation inference node can be found in the directory <code>catkin_workspace/src/workshops/section_2/pointcloud_segmentation_py</code>. The structure of this <strong>Python package</strong> is illustrated in the following:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pointcloud_segmentation_py/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── CMakeLists.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── package.xml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── assets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── image1.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── image2.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── video1.gif</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── video2.gif</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── convert_xml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── class_id_to_rgb.xml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── launch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── params.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── start_all.launch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── models</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── miou62_squeezeseg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       ├── saved_model.pb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       └── variables</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│           ├── variables.data-00000-of-00001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│           └── variables.index</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── pointcloud_segmentation.py</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The inference node source code is located in <code>src/pointcloud_segmentation.py</code>. The pretrained model is located in the directory <code>models</code>. The launch file and parameters are located in directory <code>launch</code>. The conversion between RGB encoding and class IDs are defined in <code>class_id_to_rgb.xml</code>. Feel free to read all the code, parameters and launch files to get a in-depth understanding how this inference node is working.</p>
<p>Note that the provided point cloud segmentation model is quite similar to the one you have trained in the assignment, but it was trained on a much larger dataset consisting of 40000 training samples.</p>
<p>Now, let&#x27;s build the package with <code>catkin build</code></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">catkin build pointcloud_segmentation_py</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>and source the workspace</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">source devel/setup.bash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Perfect! Now you will be able to perform inference on point cloud data with this package. Let&#x27;s go to the next section.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="replay-rosbag-and-run-point-cloud-segmentation">Replay rosbag and run point cloud segmentation<a href="#replay-rosbag-and-run-point-cloud-segmentation" class="hash-link" aria-label="Direct link to Replay rosbag and run point cloud segmentation" title="Direct link to Replay rosbag and run point cloud segmentation">​</a></h2>
<p>We have already prepared a launch file for you to execute the point cloud segmentation model. Please read carefully through the following lines of code.</p>
<p>Contents of the file <code>start_all.launch</code>:</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">launch</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">param</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">/use_sim_time</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">value</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">true</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- PLAY ROSBAG--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">node</span><span class="token tag" style="color:#00009f"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">        </span><span class="token tag attr-name" style="color:#00a4db">pkg</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">rosbag</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">        </span><span class="token tag attr-name" style="color:#00a4db">type</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">play</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">        </span><span class="token tag attr-name" style="color:#00a4db">args</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">--clock -l -r 0.75 /home/rosuser/bag/lidar_campus_melaten.bag</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">        </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">player</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">node</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!--- PCL SEGMENTATION NODE Parameters --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">rosparam</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">command</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">load</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">file</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">$(find pointcloud_segmentation_py)/launch/params.yaml</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">rosparam</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- PCL SEGMENTATION NODE --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">node</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">        </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">pointcloud_segmentation</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">        </span><span class="token tag attr-name" style="color:#00a4db">pkg</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">pointcloud_segmentation_py</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">        </span><span class="token tag attr-name" style="color:#00a4db">type</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">pointcloud_segmentation.py</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">        </span><span class="token tag attr-name" style="color:#00a4db">output</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">screen</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">node</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">launch</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This launch file will start the following tasks:</p>
<ul>
<li><strong>Replay the rosbag</strong> with a speed of 0.75. Feel free to adjust this replay speed depending on the performance of your hardware.</li>
<li><strong>Load the parameters</strong> that are necessary for the <code>pointcloud_segmentation_py</code> node</li>
<li><strong>Start the <code>pointcloud_segmentation_py</code></strong> node</li>
</ul>
<p>Note, that <code>params.yaml</code> contains the parameter</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">do_visualizations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">True</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>which will enable an internal visualization of the segmented point cloud. You can also set this value to <code>False</code> and visualize the point cloud with RVIZ.</p>
<p>We can now start the launch file with:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">roslaunch pointcloud_segmentation_py start_all.launch</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You should see now the model&#x27;s prediction as shown in the image below.</p>
<img src="../images/uploads/4a7ce26ec2d312a8a6396adaab190936/image.png" alt="Description of image">
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="review-of-file-pointcloud_segmentationpy-1">Review of file pointcloud_segmentation.py<a href="#review-of-file-pointcloud_segmentationpy-1" class="hash-link" aria-label="Direct link to Review of file pointcloud_segmentation.py" title="Direct link to Review of file pointcloud_segmentation.py">​</a></h2>
<p>Before we start with the programming exercise, lets get an overview about the point cloud segmentation node <a href="https://github.com/ika-rwth-aachen/acdc/blob/main/catkin_workspace/src/workshops/section_2/pointcloud_segmentation_py/src/pointcloud_segmentation.py" target="_blank" rel="noopener noreferrer"><code>pointcloud_segmentation.py</code></a>. Note, the segmentation node is quite complex and we do not require you to implement any in-depth function. We would like to encourage you to read the code and try to understand what each function is doing. To help you we have generated a little summary about the structure of the inference node.</p>
<p>The inference node is implemented as a Python class called <code>PCLSegmentation</code>. The class has the following member functions. We will give here a short description of each class so you can understand what each class is doing.</p>
<ul>
<li>
<p><strong>class PCLSegmentation</strong></p>
<p><em>Class which implements the point cloud segmentation task. Listens on a topic of type <code>PointCloud2</code> converts the point cloud to a 2D representation, applies point cloud segmentation and publishes the segmented point cloud on a <code>PointCloud2</code> topic.</em></p>
<ul>
<li><strong><code>__init__(self)</code></strong></li>
</ul>
<p><em>Calls all necessary functions for the initialization of the node</em></p>
<ul>
<li><strong><code>def setup(self)</code></strong></li>
</ul>
<p><em>Loads and initializes the segmentation model from a file. Creates subscriber <code>self.sub_pcl</code> and publisher <code>self.pub_seg</code> which listen and send <code>PointCloud2</code></em></p>
<ul>
<li><strong><code>load_parameters(self)</code></strong></li>
</ul>
<p><em>Loads all ROS params and stores them as class members attributes,</em></p>
<ul>
<li><strong><code>parse_convert_xml(self, conversion_file_path)</code></strong></li>
</ul>
<p><em>Reads the xml file from directory <code>convert_xml</code> and constructs all necessary variables for the class ID to color association.</em></p>
<ul>
<li><strong><code>def predict(self, pcl_msg)</code></strong></li>
</ul>
<p><em>Callback function which is triggered when a new message of type <code>PointCloud2</code> arrives at the subscriber <code>self.sub_pcl</code></em></p>
<ul>
<li><strong><code>make_point_field(self)</code></strong></li>
</ul>
<p><em>Helper function to create a <code>PointCloud2</code> with several fields.</em></p>
<ul>
<li><strong><code>rgb_to_float(self, color)</code></strong></li>
</ul>
<p><em>Helper function which can convert a RGB value to a packed float value</em></p>
<ul>
<li><strong><code>hv_in_range(self, x, y, z, fov, fov_type=&#x27;h&#x27;)</code></strong></li>
</ul>
<p><em>Function which can apply a field of view (FOV) to points with X, Y, Z values.</em></p>
<ul>
<li><strong><code>pcl_spherical_projection(self, pcl, height, width, num_channels, leftPhi, rightPhi)</code></strong></li>
</ul>
<p><em>Function which does a spherical projection of a 3D point cloud to a 2D representation</em></p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="task-1-instantiate-pointcloud2-publisher-for-the-segmented-point-cloud-1">Task 1: Instantiate <code>PointCloud2</code> publisher for the segmented point cloud<a href="#task-1-instantiate-pointcloud2-publisher-for-the-segmented-point-cloud-1" class="hash-link" aria-label="Direct link to task-1-instantiate-pointcloud2-publisher-for-the-segmented-point-cloud-1" title="Direct link to task-1-instantiate-pointcloud2-publisher-for-the-segmented-point-cloud-1">​</a></h2>
<p>In this task, you will have the easy task to implement a publisher for the segmented point cloud. As you may know, the publisher takes specific messages and sends them via the ROS Framework to other processing or visualization nodes.</p>
<p>Read the function <code>setup()</code> in the file <code>pointcloud_segmentation.py</code>. Here all important class members are created that will be called in later during the inference. You can see that we instantiate the segmentation model as <code>self.model</code>.</p>
<p>We also instantiate the subscriber for the <code>/points2</code> topic as <code>self.sub_pcl</code>. The subscriber is connected with the function <code>self.predict</code>. Whenever a new message of type <code>PointCloud2</code> arrives on <code>/point2</code>, then the callback <code>self.predict</code> is called.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">setup</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># load inference model</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">model </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">keras</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">models</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">load_model</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">model_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># create point field for cloud_creator</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">point_field </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">make_point_field</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">### START TASK 1 CODE HERE ###</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># create publisher for the segmented point cloud, publish on topic &quot;points2_segmented&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Publish type PointCloud2 data format</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">### END TASK 1 CODE HERE ###</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># create points2 subcriber and listen to topic /points2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sub_pcl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> rospy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Subscriber</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;/points2&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> PointCloud2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">predict</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> queue_size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Your task is now to implement a <code>PointCloud2</code> publisher.</p>
<p><em>Hints:</em></p>
<ul>
<li>Have a look how a <a href="https://wiki.ros.org/rospy/Overview/Publishers%20and%20Subscribers" target="_blank" rel="noopener noreferrer">rospy.Publisher()</a> works</li>
<li>We want to send messages on topic <code>/points2_segmented</code></li>
<li>We want to send messages of type <code>PointCloud2</code> which are already imported by <code>from sensor_msgs.msg import PointCloud2</code></li>
<li>Use a <code>queue_size</code> of 1</li>
<li>Save the publisher as a class member attribute</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="task-2-publish-a-pointcloud2-message-containing-the-segmented-point-cloud-with-the-publisher-1">Task 2: Publish a <code>PointCloud2</code> message containing the segmented point cloud with the publisher<a href="#task-2-publish-a-pointcloud2-message-containing-the-segmented-point-cloud-with-the-publisher-1" class="hash-link" aria-label="Direct link to task-2-publish-a-pointcloud2-message-containing-the-segmented-point-cloud-with-the-publisher-1" title="Direct link to task-2-publish-a-pointcloud2-message-containing-the-segmented-point-cloud-with-the-publisher-1">​</a></h2>
<p>Ok, now you should have setup the publisher. Now, we need to call the publisher after we perform inference in order to publish the segmented point cloud on topic <code>/points2_segmented</code>. The following code block is a snippet from function <code>def predict(self, pcl_msg)</code> in the file <code>pointcloud_segmentation.py</code>.</p>
<p>You will now have to call the publisher here</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># create list of points</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">points </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">list</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">zip</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> z</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> l</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> rgb_float</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">segmented_pcl_msg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pc2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">create_cloud</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">header</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pcl_msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">header</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                     fields</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">point_field</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                     points</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">points</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">### START TASK 2 CODE HERE ###</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># call publisher to publish &quot;segmented_pcl_msg&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">### END TASK 2 CODE HERE###</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><em>Hints:</em></p>
<ul>
<li>Use <code>.publish()</code></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="run-node-and-use-rviz-for-visualization-1">Run Node and use RVIZ for visualization<a href="#run-node-and-use-rviz-for-visualization-1" class="hash-link" aria-label="Direct link to Run Node and use RVIZ for visualization" title="Direct link to Run Node and use RVIZ for visualization">​</a></h2>
<p>Great, so now our inference node also publishes the segmented point cloud and we can now use RVIZ to visualize the segmented point cloud. You can open another terminal and start RVIZ. In RVIZ you could try to visualize the segmented point cloud to obtain an image as shown below.</p>
<p><em>Hints:</em></p>
<ul>
<li>Add -&gt; By Topic -&gt; <code>/points2_segmented</code> - <code>PointCloud2</code> -&gt; OK</li>
<li>Set the parameter <code>Global Options / Fixed Frame</code> to <code>vlp16_link</code></li>
<li>Increase the <code>Size</code> of the points</li>
</ul>
<img src="../images/uploads/cb4ded5b551f6fe13d9efeeac8180b86/image1.png" alt="Description of image">
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="wrap-up-1">Wrap-up<a href="#wrap-up-1" class="hash-link" aria-label="Direct link to Wrap-up" title="Direct link to Wrap-up">​</a></h2>
<ul>
<li>You learned about the ROS standard definition for point cloud data which is called <code>sensor_msgs/PointCloud2</code></li>
<li>You learned about a simple ROS package for semantic point cloud segmentation</li>
<li>You learned how to write a ROS publisher which publishes point cloud data</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/task/02_sensor_data_processing/07_Semantic-Point-Cloud-Segmentation.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/Autonomous-Connected-Driving/docs/task/sensor_data_processing/Semantic-Image-Segmentation"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Perform Deep Learning based semantic image segmentation applied on camera images</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/Autonomous-Connected-Driving/docs/category/object-fusion-tracking"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Object Fusion Tracking</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#start-the-docker-environment" class="table-of-contents__link toc-highlight">Start the Docker Environment</a></li><li><a href="#download-and-inspect-bag-file" class="table-of-contents__link toc-highlight">Download and inspect bag file</a></li><li><a href="#ros2s-sensor_msgsmsgpointcloud2-message" class="table-of-contents__link toc-highlight">ROS2&#39;s <code>sensor_msgs/msg/PointCloud2</code> Message</a></li><li><a href="#build-and-source-the-package" class="table-of-contents__link toc-highlight">Build and source the package</a></li><li><a href="#review-of-file-pointcloud_segmentationpy" class="table-of-contents__link toc-highlight">Review of file pointcloud_segmentation.py</a></li><li><a href="#task-1-instantiate-pointcloud2-publisher-for-the-segmented-point-cloud" class="table-of-contents__link toc-highlight">Task 1: Instantiate <code>PointCloud2</code> publisher for the segmented point cloud</a></li><li><a href="#task-2-publish-a-pointcloud2-message-containing-the-segmented-point-cloud-with-the-publisher" class="table-of-contents__link toc-highlight">Task 2: Publish a <code>PointCloud2</code> message containing the segmented point cloud with the publisher</a></li><li><a href="#run-node-and-use-rviz-for-visualization" class="table-of-contents__link toc-highlight">Run Node and use RVIZ for visualization</a></li><li><a href="#wrap-up" class="table-of-contents__link toc-highlight">Wrap-up</a></li><li><a href="#ros1-instructions" class="table-of-contents__link toc-highlight">ROS1 Instructions</a></li><li><a href="#use-the-docker-environment" class="table-of-contents__link toc-highlight">Use the Docker Environment</a></li><li><a href="#download-and-inspect-bag-file-1" class="table-of-contents__link toc-highlight">Download and inspect bag file</a></li><li><a href="#ross-sensor_msgspointcloud2-message" class="table-of-contents__link toc-highlight">ROS&#39;s <code>sensor_msgs/PointCloud2</code> Message</a></li><li><a href="#build-and-source-the-package-1" class="table-of-contents__link toc-highlight">Build and source the package</a></li><li><a href="#replay-rosbag-and-run-point-cloud-segmentation" class="table-of-contents__link toc-highlight">Replay rosbag and run point cloud segmentation</a></li><li><a href="#review-of-file-pointcloud_segmentationpy-1" class="table-of-contents__link toc-highlight">Review of file pointcloud_segmentation.py</a></li><li><a href="#task-1-instantiate-pointcloud2-publisher-for-the-segmented-point-cloud-1" class="table-of-contents__link toc-highlight">Task 1: Instantiate <code>PointCloud2</code> publisher for the segmented point cloud</a></li><li><a href="#task-2-publish-a-pointcloud2-message-containing-the-segmented-point-cloud-with-the-publisher-1" class="table-of-contents__link toc-highlight">Task 2: Publish a <code>PointCloud2</code> message containing the segmented point cloud with the publisher</a></li><li><a href="#run-node-and-use-rviz-for-visualization-1" class="table-of-contents__link toc-highlight">Run Node and use RVIZ for visualization</a></li><li><a href="#wrap-up-1" class="table-of-contents__link toc-highlight">Wrap-up</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Coding</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/Autonomous-Connected-Driving/docs/cpp/content">C++</a></li><li class="footer__item"><a class="footer__link-item" href="/Autonomous-Connected-Driving/docs/python/content">Python</a></li></ul></div><div class="col footer__col"><div class="footer__title">Robot Operating System</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/Autonomous-Connected-Driving/docs/ros/content">ROS</a></li><li class="footer__item"><a class="footer__link-item" href="/Autonomous-Connected-Driving/docs/ros2/content">ROS2</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/Autonomous-Connected-Driving/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/CagriCatik/Autonomous-Connected-Driving" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 - Automated and Connected Driving.</div></div></div></footer></div>
</body>
</html>